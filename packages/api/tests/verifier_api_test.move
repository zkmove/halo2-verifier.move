#[test_only]
module verifier_api::verifier_api_test {
    use std::vector;
    use aptos_std::crypto_algebra;
    use verifier_api::param_store;
    use std::signer;
    use std::unit_test;
    use verifier_api::verifier_api;

    // the following param data is generated from `crates/vk-gen-examples/params/challenge_0078-kzg_bn254_16.srs`
    // they all in compressed form of arkworks
    #[test_only]
    const TESTING_G1: vector<u8> = x"0100000000000000000000000000000000000000000000000000000000000000";
    #[test_only]
    const TESTING_G2: vector<u8> = x"edf692d95cbdde46ddda5ef7d422436779445c5e66006a42761e1f12efde0018c212f3aeb785e49712e7a9353349aaf1255dfb31b7bf60723a480d9293938e19";
    #[test_only]
    const TESTING_S_G2: vector<u8> = x"e4115200acc86e7670c83ded726335def098657fe8668323e9e41e6781b83b0a9d83b54bbb00215323ce6d7f9d7f331a286d7707d03f7dbdd3125c6163588d13";

    #[test(s = @aptos_std)]
    public fun check_verify_ok(s: &signer) {
        crypto_algebra::enable_cryptography_algebra_natives(s);
        let signers = unit_test::create_signers_for_testing(1);
        let signer = vector::pop_back(&mut signers);
        param_store::create(&signer, TESTING_G1, TESTING_G2, TESTING_S_G2);
        // protocol of example vector-mul
        // generated by `cargo run --release --  --param-path params/challenge_0078-kzg_bn254_16.srs --verifier-address 0xcfae5b6bd579e7aff4274aeca434bb500c024b89c139b545c6eeb27bfafea8c1 build-publish-vk-aptos-txn --example vector-mul -o vk_deployment`
        verifier_api::publish_circuit(&signer,vector[
            x"0f040b991d2f930e735f0028ac957fb7ab6707474ed4eedbfe4f7cbb391c6f07",
            x"baaa5c0c4c452e320267ee0a90b648c30821c86d8627359fcb32e13deb83ad02",
            x"8703f8f88dac3610100dfbe5bb52498335e94896d2268e0128976bb88e15ec1bd7e110682012410aaebe615ee56d487414c5cdf4edc3ea7c94c18898207f750438eb14dd26e292dc9e41920db4619a83a4b6c5691825d26cc4a33fb29ccd69499a8c64ea83540da5130cd2f098126287ba27fc2f51dd20bc9fc7fe5bdfb3dd51",
            x"10",
            x"01000000",
            x"03000000",
            x"0100000000000000",
            x"0100000000000000",
            x"000000",
            x""
        ],
            vector[
                x"00000000000100000000",
                x"00010000000100000000",
                x"00020000000100000000"
            ],
            vector[
                x"f4000000000100000000"
            ],
            vector[x"ff000000000100000000"],
            vector[
                x"f400000000",
                x"0000000000",
                x"0001000000",
                x"0002000000"
            ],
            vector[],
            vector[
                x"0000080200070803000301060302"
            ],
            vector[],
            vector[],
            vector[],
            vector[]
        );
        let proof = x"06661ff6e3bd260e8dc4f9096034eaf96782d3fed55ec7fbc5928d2a8de1dd5ce1563c6c4fbc544a0544f957202b6cdcfb0b2e203ba886694a19542d8f749c2d9d0fe09c16f5172e45e48f82f28679649c482ae4baacec0c4d5514711eb4aa255508673b9a378da619ab1d60b24a077e7d4489f19e8b6610542d92ff65bb8d6b5442ab04b452a5199776c980dafb6e6ef641b08ce72c0c1560256b552a2a0520ce48ece7c5dd11faa9945ef0cdaffe033d613b6ee01a9584338a37dc189b6954e0fb075b65df7afa31f16a23fdda32d53accf86e4ab33c64b9237f9c77173267ce4d15888440edac1fb6c68a89c7d6064168e5d9f75e1a1145302b0152acf82a0af1768791ba83b2af7dd6017abf50b1a76a33c1a1e4c67aa45b112525bfd04199e7edf57761823f0631982d7d1697f8566cd3fc5b4cf51483eef3f043edba6427146897c39fef248906393e6432fea6fe06512691f951c284fec2925d73a6130c9d277300882e6851460f84478d312a444dad1df2538e92968b8ea553b2bb2fb9b422a265721ec590e239f4d56ae149969965f67f2feade42e802973a3b9802ad1b22028d99a296f53b099dbadaa219678bbbb645586987c2698c975a60231719cc6bdccaaf7d324de8f7a3b1d341a5e1381900bcf88094aa771b87911dd4227783301342491442d31acf2b2022944e30ebe9439f73b2e4bfc80a12d4de7013a73b77797f1208e1e4b88b02aec8b5c85dbae913b55dd08f2fed2363afdf0208cab543b662ae9158637203dd6ad77dc049ca7770d6751de20c9cc54cea9d4912f82b43090a9cd174edd4b60c7b165d2a80d48d013835d8a9cf1271567fb2c91fe5f085c44f5b7e2635d284b21cb6452906227601ca585e8ddd3a5b0150c84e0e2e45ae48d038ff74a2dac1a862394c430cc37e19d062e39c69bcc48a11285d17ce446616ec4f9ef25f426d3446ec2c3ad1931991760d0ea538176618202a471bd105ad235590a53d50d8d497f77d40a943b8ba2d4543d6f7548a6137040cf7145656913e53b8cb3b7ef81e4581a3a27d9053a3d14447b9d6ae5d37c42c62612a2f57b718f3a0f604d55b046e9dec1c1007c9d67756afdfea7c5459c6309ae92f165c32f377d692d25d895ff502e9a33687f05d7398466e83bd7746b46318ea01433a3f57d53a9d62aef5e755dbf5b838403ff0d725f9523e04316369ab75f92bb173e99f30ac90d05f44cd5b5b188585f08dbdcda8003c5b46ed939504830c2e2f8bad480e3bec5806bc124ea7542d3a27eea0edf02c65abe2fc447850a0e328d8616a9772d0c1d0d20ca6164f81e943da26774ba5b0e37aa70f46cd3ba47811285b4d60c04ce22089b9df64b9625369e67887431b8c81536feb200031e2c22dbad8ae253d3bcef176657dccc0cd756874c99d68316b44e65a54c9e3002980523d23d9c66ac2e1d4d3a19d486d1c437a45a44a847339fe636b6eefc6ab93570a";
        let instances = vector[
            x"0600000000000000000000000000000000000000000000000000000000000000",
            x"0600000000000000000000000000000000000000000000000000000000000000",
            x"0600000000000000000000000000000000000000000000000000000000000000"
        ];
         verifier_api::verify_proof_gwc(signer::address_of(&signer), signer::address_of(&signer),  vector::singleton(instances), proof);
    }

    #[test(s = @aptos_std)]
    public fun check_verify_shuffle_api_ok(s: &signer) {
        crypto_algebra::enable_cryptography_algebra_natives(s);
        let signers = unit_test::create_signers_for_testing(1);
        let signer = vector::pop_back(&mut signers);
        param_store::create(&signer, TESTING_G1, TESTING_G2, TESTING_S_G2);
        // protocol of example shuffle-api
        // generated by `cargo run --release -- --param-path params/challenge_0078-kzg_bn254_16.srs --verifier-address c5be6b4d9ca3f9bfbf4edd9a3cf434f2b136df23b69b66306e6a2d0378c34458 build-publish-vk-aptos-txn --example shuffle-api -o vk_deployment`
        
        verifier_api::publish_circuit(&signer,
            vector[
                x"5ed91716521c30ca9c8322f2908211f5f1b6bb9bf47ee7439f9df6aac933dd2c",
                x"bce0ce37c00b841d90697913f3b1653d3281fbc05a8f106075edd4597b138d0b74c80ac6072406d2d0ffba6dc4919f0fd1d570e6ace1a812bfa5d44a406a6a6374c80ac6072406d2d0ffba6dc4919f0fd1d570e6ace1a812bfa5d44a406a6a63",
                x"",
                x"10",
                x"01000000",
                x"04000000",
                x"0300000000000000",
                x"0000000000000000",
                x"000000",
                x""
            ],
            vector[
                x"00000000000100000000",
                x"00010000000100000000",
                x"00020000000100000000"
            ],
            vector[],
            vector[
                x"ff000000000100000000",
                x"ff010000000100000000",
                x"ff020000000100000000",
            ],
            vector[],
            vector[],
            vector[],
            vector[],
            vector[],
            vector[
                x"000008020203000802020200"
            ],
            vector[
                x"000008020103010802010302"
            ],
        );
        let proof = x"47e4688418f21da809dac262edf7975752d4193026b7858bd1949d67cbaf2242e90550f0211090a27c12a9ee7f41ca20be7ce3716993cdcd484bfec41f72e4003811bb70c6380e3333369277c49142f92041125372e2b10f961359f066ac9c4ccb2958288fc1a3ea7527f6bce63fc137496968c60b675a1b59ac93ac1a87a91452c4710ccaa29b80392e7625584047fec3f4ed48a470830d6502376b6b066b4c441e09142af4397b6de5ae42084fd5405577a171c8419decbf9902d39b63326818d15ae793fc4e99360bc812ff1df047a74354c53d771eb2fc13f035af227021189fc6e2dd2c011a5cc87f8e63016efb347f6097f4158fe19b1a5be70e077456265d70b893931799e86d603e33eaaa9bd24859b50c2656ab3ff752dde7cd9f0cd050e8bf9cc1b0328330942edac820275e580b52e665223a59743c7a0e8aa10c388fa60b86c25892c30054cc88cac5643fa7498247854839f5806ff7e406d219fbbe3e4bb59a3fabcd4f33bb09f52783119b38062f38ba9a4318b27647152b17496939c88b4692d961168c74ba6941b0d507da9aa2be03b7f88a23e863133f1f496939c88b4692d961168c74ba6941b0d507da9aa2be03b7f88a23e863133f1f0bb1d820c63a7b662f52c5dc374daa3fa6a17aa6ba6d2987875a77176111592ec90342b1e154ac0ffa2413d60397da4d67b83f4c6aad4266055d354732dbce06945d25c931ec5c462af043297000df7ab088d4afea8d9764cc465fa77979341ff4799b5f722e896351316d893e7d9cff251093c55a72153e7f1ebaa699c3e144bfa640e10c1852240c24d7f2d7983c30c94fceaf8eddd5f4aaac0e291cad7706";
        let instances = vector[];
         verifier_api::verify_proof_gwc(signer::address_of(&signer), signer::address_of(&signer),  vector::singleton(instances), proof);
    }

}
