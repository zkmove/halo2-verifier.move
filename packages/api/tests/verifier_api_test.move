#[test_only]
module verifier_api::verifier_api_test {
    use std::vector;
    use aptos_std::crypto_algebra;
    use verifier_api::param_store;
    use std::signer;
    use std::unit_test;
    use verifier_api::verifier_api;

    // the following param data is generated from `crates/vk-gen-examples/params/challenge_0078-kzg_bn254_16.srs`
    // they all in compressed form of arkworks
    #[test_only]
    const TESTING_G1: vector<u8> = x"0100000000000000000000000000000000000000000000000000000000000000";
    #[test_only]
    const TESTING_G2: vector<u8> = x"edf692d95cbdde46ddda5ef7d422436779445c5e66006a42761e1f12efde0018c212f3aeb785e49712e7a9353349aaf1255dfb31b7bf60723a480d9293938e19";
    #[test_only]
    const TESTING_S_G2: vector<u8> = x"e4115200acc86e7670c83ded726335def098657fe8668323e9e41e6781b83b0a9d83b54bbb00215323ce6d7f9d7f331a286d7707d03f7dbdd3125c6163588d13";

    #[test(s = @aptos_std)]
    public fun check_verify_ok(s: &signer) {
        crypto_algebra::enable_cryptography_algebra_natives(s);
        let signers = unit_test::create_signers_for_testing(1);
        let signer = vector::pop_back(&mut signers);
        param_store::create(&signer, TESTING_G1, TESTING_G2, TESTING_S_G2);
        // protocol of example vector-mul
        // generated by `cargo run --release --  --param-path params/challenge_0078-kzg_bn254_16.srs --verifier-address 0xcfae5b6bd579e7aff4274aeca434bb500c024b89c139b545c6eeb27bfafea8c1 build-publish-vk-aptos-txn --example vector-mul -o vk_deployment`
        verifier_api::publish_circuit(&signer,vector[
            x"3f8c4673ba5c3eb53ddb38c02cfa47483c4d6a25fbc64ea44c50309fbd413d2c",
            x"a7c40e6e753cfd404ff8e10e1352a3eb77c8e0495bf1d9b7c67410ce4f2a5a98",
            x"f1ad77997188215fb04be428716b389ff29c6ef944e36ab74ffaa9d192d324858d6c5ae20545006f1f4c93446419c848a95dd8e567a2990c1cba488d4a196f0fa9f81ad6c30148acd3011bfd4d6f9a129c577dd059acb81a26d86e7afab696aba66350b2d5606122fa883ea1232fc384ffae8f8e3db990ef760506abf2f5f284",
            x"0c",
            x"01000000",
            x"03000000",
            x"0100000000000000",
            x"0100000000000000",
            x"000000",
            x"",
            x"00",
            x"00"
        ],
            vector[
                x"01000000000100000000",
                x"01010000000100000000",
                x"01020000000100000000"
            ],
            vector[
                x"03000000000100000000"
            ],
            vector[x"02000000000100000000"],
            vector[
                x"0300000000",
                x"0100000000",
                x"0101000000",
                x"0102000000"
            ],
            vector[],
            vector[
                x"080200070803000301060302"
            ],
            vector[],
            vector[],
            vector[],
            vector[]
        );
        let proof = x"3681c1d1817d8b98dd7b522ccecf2cf190a4a8e1cf6f8a743b7acdcab33e26132211205f30ce2b988edbc8bcea6b4c5970280f1aa1b8248264ca8e265575878d00bd3fc17b08e9dd6bd7f6484ab6a79997c68d542eacd86167eb42d169f42690917e64f9a25d79b2a35c01e50fd522cf1e0f1972a268ab99fc2a66fab4c1fbaac7f928a6bbe3678f2210aca958e4274b36cbabecc23249c146db0e5c6d5f0e8e27b134238e08c4edf54b874dd1d5a0176872fd428d2e72765a86ed36f1c82600435ffc17a391a89cdc95642ce72e58ef8f6a8d13844e730c75d291e30bf4dca2137aded2207d1fc5226f90535c4758d1dc436edda9f049067bbb465c747c6001d61e52ea8e5c441ed55f4244c85b515f7fd28229641b829594e612783292440da0457df8f2ca01b837c681e9a8f34bb722082aa62b0f7a6eaaf9b874197f309707266faa9f823e2d4ded37f2a001ebbc2bc1e58a912673e088d643ee5af23a1a7aec68c383498a080b617c98af567a96510c1f5ac6988fb2cdc7a6af0ee1fd26f4e8557b441079497d91be7c59810c3148c9a479f893261e7c0c5ee008577f2718fd4aaa5ba24c4421962a05be3e0ec807f7f46aa55ca1b5bb78cf5a6bc27b0139d5e24bca1b57b1d66bd3c3ad17d6c219c85d14f8ce7311ad1f12453db020300d119d602a3bb5ed00f1b0718bbff5ff03ebe3d65f8d94200769bd1f90a4952dbd5f54d0adb5c309fe6e01fc24f9baef6c6b571c8049f234c0c139bc01a3df293805bb83f48a4c26fca011e67bf7080f01ad3151725c4a391f97a0d7b34d3517e16a4cec8a676c67a133c3d42ec2d644b05feaa6ac0ca09c44134fe77740bc19abd4a981d7fd95cebb4bee3787d9d163e57d161ded20203f5ab3f051ecfec71a4cb0716ada6eca73949c893f83a75d6a69b918604876359076cc58817baa8828a3e127b5111be026655ae8edefd79ced3e5bd05521bdbe3198404327c0408f161b6a98303867cb77b3e6ce674a457b0ecd738107db2966534797adb039b48d0d8fe6df89f67d84f42cb19b2d3799b168ef550450f878b59e4fe1bb9c8d64871e896eedc50241740c64cbab5aa2415043ef5c095529370fb03adbc6ec8e22852c7aa92729889a956df02a7fdc66db20d151805e7afb33e9d4c53ea41fa90bf822ea572c361cf6136c7d6ba50275bff40721f888216b4d19f3dd18d7768a41b2053039e17cdbd0d70721e76224f2bb5b541c03123da922b23948b98a05a92bec0eb917bf500dd0947ca27863faf9eed01a7d81852a3016bc0e1a36457ccb6632278448d6e99bd631cbd007de80ce1b693601b723a8e3b2c75f781bc2124ee7cc076e6b66d210a85d8adae856bf722facb2d811332ab1f343f8a28d94a926ca229d652dc60060c241e7548394cd4885a67f725551a85048295e012b333ab297fd007f77e22ecb19e7ef1ee6a7cbdc3e9945beb9638ef065a697c46d79c0de01a793";

        let instances = vector[
            x"0600000000000000000000000000000000000000000000000000000000000000",
            x"0600000000000000000000000000000000000000000000000000000000000000",
            x"0600000000000000000000000000000000000000000000000000000000000000"
        ];
        verifier_api::verify_proof_gwc(signer::address_of(&signer), signer::address_of(&signer),  vector::singleton(instances), proof);
    }

    #[test(s = @aptos_std)]
    public fun check_verify_shuffle_api_ok(s: &signer) {
        crypto_algebra::enable_cryptography_algebra_natives(s);
        let signers = unit_test::create_signers_for_testing(1);
        let signer = vector::pop_back(&mut signers);
        param_store::create(&signer, TESTING_G1, TESTING_G2, TESTING_S_G2);
        // protocol of example shuffle-api
        // generated by `cargo run --release -- --param-path params/challenge_0078-kzg_bn254_16.srs --verifier-address c5be6b4d9ca3f9bfbf4edd9a3cf434f2b136df23b69b66306e6a2d0378c34458 build-publish-vk-aptos-txn --example shuffle-api -o vk_deployment`

        verifier_api::publish_circuit(&signer,
            vector[
                x"f1ce230d5a637b306b889277dc9bf3a9724825c6a2f370bc9b255b50c3ccc81c",
                x"1a7fd0fa4054506ac682d6f8cb2d976ec3147686904f54ec212ae8124cc37a103fea4494b89963707c458607ff27a4afc33991dd68035466536cc15a7edf431f3fea4494b89963707c458607ff27a4afc33991dd68035466536cc15a7edf431f",
                x"",
                x"0c",
                x"01000000",
                x"04000000",
                x"0300000000000000",
                x"0000000000000000",
                x"000000",
                x"",
                x"00",
                x"00"
            ],
            vector[
                x"01000000000100000000",
                x"01010000000100000000",
                x"01020000000100000000"
            ],
            vector[],
            vector[
                x"02020000000100000000",
                x"02000000000100000000",
                x"02010000000100000000"
            ],
            vector[],
            vector[],
            vector[],
            vector[],
            vector[],
            vector[
                x"08020003000802000201"
            ],
            vector[
                x"08020203010802020302"
            ],
        );
        let proof = x"f5bafcd9b6532780c3f8d210adf84d3b5e7784dd0351b01c631c530be77596007fc827676ead67509ef5235fa197783c18a1dd87acaef4c57afc6b255b258121081a1089d2615f0e6aaaafa2c88aeec8f7a9f6568a6b620af375a43714ed8598c99dcf3fdff516b4607448f6d2068320d3e914e8f51ddfe292a28cade54b77827b1de4f48c888a7c3a7222cc3bbc19bac0d6b8576b3b4e5136297b6f1f41e81433ed43bc8d3e768d53428325f086698ee6cd05958b1091093ee09e070f82e08631071afbf67e70cca3f3cfd2ad57fcc5451aef73c68766d49a08e4d1d09d3821e7172f0c8be639576b123541acd213353c1bc76286fbdd8c60b4974e2a098c172fa20e66215266e22330318eeff8841f11bb9dc3952d4f860e7f1dcffff0bb1c67f638a10921cee435271471b1c027ec876e86edb2ec9f5ea78de74f76fa3b15eeee290ced940888d8027d47d9ceac36b9d5c051dbd0690a926e15b15f463504cf9c2bf18b66c00f5f5f9948e2d7ee2dbc8fcd5f1c6002ff242a766914707527622d1779d0a7ac3b99f180d499d52a6a93b1228cc4c8d92c37ad867611a68812cf9c2bf18b66c00f5f5f9948e2d7ee2dbc8fcd5f1c6002ff242a766914707527c3ddda806b49c0095c4e0e5f32c04d8d92f6afa7a6b0354ddda272c84aff01162a48c813eac8c94cd13ea02bda34da55ec042c921933a355f83af452803b87270837265a2e02ff1ec82ac7f9955b709ad7cc7ee61057cccfa8f9543abb6fb901b0875bf59fab775eebcec4f0b985f76e0d08e7d874ce7a032ea6b429ef869d0d3b3b6e70aa9fa7f37f45aac8f4e0093619ddc359f699e848a2c3874b83047222";
        let instances = vector[];
        verifier_api::verify_proof_gwc(
            signer::address_of(&signer),
            signer::address_of(&signer),
            vector::singleton(instances),
            proof
        );
    }

}
